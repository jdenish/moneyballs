<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Jordan's Moneyballs</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useMemo, useCallback, memo, useEffect } = React;

    // Embedded tournament save data (slim share format) for completed tournaments
    const TOURNAMENT_STATES = {
      '2026-02-06': {
        tc:16,rg:3,rp:11,wc:8,
        t:[
          {p1Name:'Oscar Serra',p1Dupr:'',p2Name:'Sanil Jagtiani',p2Dupr:''},
          {p1Name:'Jack Hared',p1Dupr:'',p2Name:'Preston Gordon',p2Dupr:''},
          {p1Name:'Matvey Radionov',p1Dupr:'',p2Name:'Matt Meadows',p2Dupr:''},
          {p1Name:'Lukas Choi',p1Dupr:'',p2Name:'William Hayes',p2Dupr:''},
          {p1Name:'Jordan Denish',p1Dupr:'',p2Name:'Alex Tong',p2Dupr:''},
          {p1Name:'Conor Landrigan',p1Dupr:'',p2Name:'Geoff Watson',p2Dupr:''},
          {p1Name:'Cody Sadreameli',p1Dupr:'',p2Name:'Dan Wach',p2Dupr:''},
          {p1Name:'Jeff Comer',p1Dupr:'',p2Name:'Kenoa Tio',p2Dupr:''},
          {p1Name:'Matthew Matro',p1Dupr:'',p2Name:'Zach Bowe',p2Dupr:''},
          {p1Name:'Bruno Casino Remondo',p1Dupr:'',p2Name:'Drew Von Bargen',p2Dupr:''},
          {p1Name:'Austin Gow',p1Dupr:'',p2Name:'Peter Weaver',p2Dupr:''},
          {p1Name:'Austin Keefer',p1Dupr:'',p2Name:'Mason McCabe',p2Dupr:''},
          {p1Name:'Alex Boory',p1Dupr:'',p2Name:'Ronald Marchese',p2Dupr:''},
          {p1Name:'Shashank Kamdar',p1Dupr:'',p2Name:'Zachary Lessner',p2Dupr:''},
          {p1Name:'Kevin Herod',p1Dupr:'',p2Name:'Jameson Mays',p2Dupr:''},
          {p1Name:'Matthew Chen',p1Dupr:'',p2Name:'Johny Mario',p2Dupr:''}
        ],
        ss:{g1m0:{s1:'11',s2:'1'},g1m1:{s1:'11',s2:'4'},g1m2:{s1:'9',s2:'11'},g1m3:{s1:'11',s2:'7'},g1m4:{s1:'11',s2:'4'},g1m5:{s1:'11',s2:'8'},g1m6:{s1:'13',s2:'11'},g1m7:{s1:'13',s2:'11'},g2m0:{s1:'11',s2:'5'},g2m1:{s1:'11',s2:'2'},g2m2:{s1:'11',s2:'2'},g2m3:{s1:'13',s2:'11'},g2m4:{s1:'13',s2:'11'},g2m5:{s1:'4',s2:'11'},g2m6:{s1:'7',s2:'11'},g2m7:{s1:'11',s2:'5'},g3m0:{s1:'11',s2:'0'},g3m1:{s1:'11',s2:'5'},g3m2:{s1:'11',s2:'7'},g3m3:{s1:'11',s2:'9'},g3m4:{s1:'11',s2:'4'},g3m5:{s1:'11',s2:'1'},g3m6:{s1:'11',s2:'1'},g3m7:{s1:'11',s2:'9'}},
        bo:{},
        rm:[
          [{t1:0,t2:8},{t1:7,t2:15},{t1:1,t2:9},{t1:6,t2:14},{t1:2,t2:10},{t1:5,t2:13},{t1:3,t2:11},{t1:4,t2:12}],
          [{t1:0,t2:7},{t1:8,t2:15},{t1:1,t2:6},{t1:9,t2:14},{t1:2,t2:5},{t1:10,t2:13},{t1:3,t2:4},{t1:11,t2:12}],
          [{t1:0,t2:15},{t1:7,t2:8},{t1:1,t2:14},{t1:6,t2:9},{t1:2,t2:13},{t1:5,t2:10},{t1:3,t2:12},{t1:4,t2:11}]
        ],
        bt:'double',b3:true,ps:0,cc:8,
        p:{0:0,1:1,2:2,3:3,4:3,5:2,6:1,7:0,8:0,9:1,10:2,11:3,12:3,13:2,14:1,15:0},
        mg:true,oc:{},bso:null,ph:'bracket',
        bs:{
          wqf1:{a:1,b:7,s1:'15',s2:'6'},wqf2:{a:2,b:6,s1:'15',s2:'5'},wqf3:{a:3,b:4,s1:'15',s2:'4'},wqf4:{a:5,b:8,s1:'11',s2:'15'},
          lr1m1:{a:10,b:16,s1:'15',s2:'4'},lr1m2:{a:9,b:15,s1:'11',s2:'15'},lr1m3:{a:12,b:11,s1:'13',s2:'15'},lr1m4:{a:14,b:13,s1:'14',s2:'16'},
          wsf1:{a:1,b:2,s1:'15',s2:'1'},wsf2:{a:3,b:8,s1:'15',s2:'4'},
          wf:{a:1,b:3,g:[{s1:'11',s2:'4'},{s1:'12',s2:'10'}]},
          lr2m1:{a:10,b:7,s1:'15',s2:'8'},lr2m2:{a:15,b:6,s1:'15',s2:'13'},lr2m3:{a:11,b:4,s1:'12',s2:'15'},lr2m4:{a:13,b:5,s1:'4',s2:'15'},
          lr3m1:{a:10,b:15,s1:'15',s2:'3'},lr3m2:{a:4,b:5,s1:'8',s2:'15'},
          lr4m1:{a:10,b:2,s1:'15',s2:'17'},lr4m2:{a:5,b:8,s1:'11',s2:'15'},
          lsf:{a:2,b:8,s1:'15',s2:'6'},lf:{a:2,b:3,s1:'13',s2:'15'},
          gf:{a:1,b:3,g:[{s1:'11',s2:'6'},{s1:'11',s2:'3'}]}
        }
      },
      '2026-02-20': {
        tc:16,rg:3,rp:11,wc:8,
        t:[
          {p1Name:'Troy Clemmer',p1Dupr:'',p2Name:'Brandon Fritze',p2Dupr:''},
          {p1Name:'Garrison Eaby',p1Dupr:'',p2Name:'Michael Benash',p2Dupr:''},
          {p1Name:'Matt Meadows',p1Dupr:'',p2Name:'Matvey Radionov',p2Dupr:''},
          {p1Name:'Jack Hared',p1Dupr:'',p2Name:'Ram Kotnana',p2Dupr:''},
          {p1Name:'Jordan Denish',p1Dupr:'',p2Name:'Alex Tong',p2Dupr:''},
          {p1Name:'Alex Szczepkowski',p1Dupr:'',p2Name:'Jase Volz',p2Dupr:''},
          {p1Name:'Tyler Arsenault',p1Dupr:'',p2Name:'Zach Bowe',p2Dupr:''},
          {p1Name:'Bruno Casino Remondo',p1Dupr:'',p2Name:'Drew Von Bargen',p2Dupr:''},
          {p1Name:'Dylan Ashbach',p1Dupr:'',p2Name:'Steven Fernandez',p2Dupr:''},
          {p1Name:'Matt Korsak',p1Dupr:'',p2Name:'Cody Sadreameli',p2Dupr:''},
          {p1Name:'Brandon Fooks',p1Dupr:'',p2Name:'Kenoa Tio',p2Dupr:''},
          {p1Name:'Lukas Choi',p1Dupr:'',p2Name:'Zachary Lessner',p2Dupr:''},
          {p1Name:'Austin Keefer',p1Dupr:'',p2Name:'Mason McCabe',p2Dupr:''},
          {p1Name:'Kevin Herod',p1Dupr:'',p2Name:'Jameson Mays',p2Dupr:''},
          {p1Name:'Samuel Darla',p1Dupr:'',p2Name:'Ashwin Korde',p2Dupr:''},
          {p1Name:'Matthew Chen',p1Dupr:'',p2Name:'Johny Mario',p2Dupr:''}
        ],
        ss:{g1m0:{s1:'11',s2:'3'},g1m1:{s1:'11',s2:'3'},g1m2:{s1:'11',s2:'1'},g1m3:{s1:'6',s2:'11'},g1m4:{s1:'11',s2:'5'},g1m5:{s1:'11',s2:'3'},g1m6:{s1:'11',s2:'5'},g1m7:{s1:'11',s2:'13'},g2m0:{s1:'12',s2:'10'},g2m1:{s1:'2',s2:'11'},g2m2:{s1:'11',s2:'4'},g2m3:{s1:'4',s2:'11'},g2m4:{s1:'11',s2:'6'},g2m5:{s1:'8',s2:'11'},g2m6:{s1:'11',s2:'2'},g2m7:{s1:'9',s2:'11'},g3m0:{s1:'13',s2:'11'},g3m1:{s1:'11',s2:'3'},g3m2:{s1:'11',s2:'2'},g3m3:{s1:'11',s2:'6'},g3m4:{s1:'11',s2:'1'},g3m5:{s1:'11',s2:'1'},g3m6:{s1:'11',s2:'2'},g3m7:{s1:'11',s2:'7'}},
        bo:{},
        rm:[
          [{t1:0,t2:15},{t1:7,t2:8},{t1:1,t2:14},{t1:6,t2:9},{t1:2,t2:13},{t1:5,t2:10},{t1:3,t2:12},{t1:4,t2:11}],
          [{t1:0,t2:8},{t1:15,t2:7},{t1:1,t2:9},{t1:14,t2:6},{t1:2,t2:10},{t1:13,t2:5},{t1:3,t2:11},{t1:12,t2:4}],
          [{t1:0,t2:7},{t1:8,t2:15},{t1:1,t2:6},{t1:9,t2:14},{t1:2,t2:5},{t1:10,t2:13},{t1:3,t2:4},{t1:11,t2:12}]
        ],
        bt:'double',b3:true,ps:4,cc:8,
        p:{0:0,1:1,2:2,3:3,4:3,5:2,6:1,7:0,8:0,9:1,10:2,11:3,12:3,13:2,14:1,15:0},
        mg:true,oc:{},
        bso:{winners:[
          {seed:2,name:'Garrison Eaby / Michael Benash'},{seed:4,name:'Jack Hared / Ram Kotnana'},
          {seed:3,name:'Matt Meadows / Matvey Radionov'},{seed:1,name:'Troy Clemmer / Brandon Fritze'},
          {seed:10,name:'Matt Korsak / Cody Sadreameli'},{seed:8,name:'Bruno Casino Remondo / Drew Von Bargen'},
          {seed:6,name:'Alex Szczepkowski / Jase Volz'},{seed:12,name:'Lukas Choi / Zachary Lessner'}
        ],losers:[
          {seed:9,name:'Dylan Ashbach / Steven Fernandez'},{seed:11,name:'Brandon Fooks / Kenoa Tio'},
          {seed:7,name:'Tyler Arsenault / Zach Bowe'},{seed:5,name:'Jordan Denish / Alex Tong'},
          {seed:13,name:'Austin Keefer / Mason McCabe'},{seed:14,name:'Kevin Herod / Jameson Mays'},
          {seed:15,name:'Samuel Darla / Ashwin Korde'},{seed:16,name:'Matthew Chen / Johny Mario'}
        ]},
        ph:'bracket',
        bs:{
          wqf1:{a:2,b:12,s1:'15',s2:'1'},wqf2:{a:1,b:10,s1:'15',s2:'8'},wqf3:{a:4,b:6,s1:'15',s2:'8'},wqf4:{a:3,b:8,s1:'15',s2:'13'},
          lr1m1:{a:9,b:16,s1:'15',s2:'7'},lr1m2:{a:5,b:13,s1:'15',s2:'6'},lr1m3:{a:11,b:15,s1:'15',s2:'4'},lr1m4:{a:11,b:14,s1:'8',s2:'15'},
          wsf1:{a:2,b:1,s1:'16',s2:'14'},wsf2:{a:4,b:3,s1:'15',s2:'12'},
          wf:{a:2,b:4,g:[{s1:'3',s2:'11'},{s1:'9',s2:'11'}]},
          lr2m1:{a:9,b:7,s1:'15',s2:'8'},lr2m2:{a:5,b:8,s1:'15',s2:'13'},lr2m3:{a:11,b:12,s1:'10',s2:'15'},lr2m4:{a:14,b:10,s1:'14',s2:'16'},
          lr3m1:{a:9,b:5,s1:'13',s2:'15'},lr3m2:{a:12,b:10,s1:'9',s2:'15'},
          lr4m1:{a:5,b:1,s1:'9',s2:'15'},lr4m2:{a:5,b:3,s1:'11',s2:'15'},
          lsf:{a:1,b:3,s1:'8',s2:'15'},lf:{a:3,b:2,s1:'15',s2:'10'},
          gf:{a:4,b:3,g:[{s1:'11',s2:'4'},{s1:'9',s2:'11'},{s1:'1',s2:'11'}]},
          gf2:{a:4,b:3,s1:'7',s2:'15'}
        }
      }
    };

    const TOURNAMENTS = [
      {
        id: '2026-02-06',
        date: 'February 6, 2026',
        title: 'Moneyball #1',
        status: 'completed',
        results: {
          first: 'Oscar Serra / Sanil Jagtiani',
          second: 'Matvey Radionov / Matt Meadows',
          third: 'Jack Hared / Preston Gordon'
        }
      },
      {
        id: '2026-02-20',
        date: 'February 20, 2026',
        title: 'Moneyball #2',
        status: 'completed',
        results: {
          first: 'Matt Meadows / Matvey Radionov',
          second: 'Jack Hared / Ram Kotnana',
          third: 'Garrison Eaby / Michael Benash'
        }
      },
      {
        id: '2026-03-06',
        date: 'March 6, 2026',
        title: 'Moneyball #3',
        status: 'upcoming',
        teamCount: 16
      },
      {
        id: '2026-03-27',
        date: 'March 27, 2026',
        title: 'Moneyball #4',
        status: 'upcoming',
        teamCount: 16
      }
    ];

    const PAYOUTS = {
      8: { first: 200, second: 100, third: 40 },
      9: { first: 240, second: 100, third: 40 },
      10: { first: 260, second: 120, third: 40 },
      11: { first: 300, second: 140, third: 40 },
      12: { first: 360, second: 160, third: 60 },
      13: { first: 400, second: 180, third: 60 },
      14: { first: 440, second: 200, third: 60 },
      15: { first: 480, second: 200, third: 80 },
      16: { first: 500, second: 220, third: 100 }
    };

    // ========== Read-Only Components ==========

    const SeedingMatch = memo(({ match, score, poolColor }) => {
      const isComplete = score.s1 !== undefined && score.s2 !== undefined && score.s1 !== '' && score.s2 !== '';
      const t1Won = isComplete && parseInt(score.s1) > parseInt(score.s2);
      const t2Won = isComplete && parseInt(score.s2) > parseInt(score.s1);

      return (
        <div className={`p-2 rounded border ${isComplete ? 'bg-gray-800 border-green-600' : 'bg-gray-800 border-gray-600'}`} style={poolColor ? { borderLeftWidth: '3px', borderLeftColor: poolColor } : undefined}>
          <div className={`flex items-center gap-2 ${t1Won ? 'text-green-400' : 'text-gray-300'}`}>
            <span className="text-xs bg-gray-700 px-1 rounded">{match.t1.seed}</span>
            <span className="flex-1 text-sm truncate">{match.t1.name}</span>
            <span className="w-12 text-center text-sm font-mono">{score.s1 || '-'}</span>
          </div>
          <div className={`flex items-center gap-2 mt-1 ${t2Won ? 'text-green-400' : 'text-gray-300'}`}>
            <span className="text-xs bg-gray-700 px-1 rounded">{match.t2.seed}</span>
            <span className="flex-1 text-sm truncate">{match.t2.name}</span>
            <span className="w-12 text-center text-sm font-mono">{score.s2 || '-'}</span>
          </div>
        </div>
      );
    });

    const BracketMatch = memo(({ match, score, winner, placement }) => {
      if (!match) return null;
      // Prefer team data from saved scores (authoritative) over generated bracket structure
      const t1 = (score.t1 && score.t1.name) ? score.t1 : match.t1;
      const t2 = (score.t2 && score.t2.name) ? score.t2 : match.t2;
      const hasBo3Games = score.games && score.games.length > 0;
      const t1Won = winner && t1 && winner.seed === t1.seed;
      const t2Won = winner && t2 && winner.seed === t2.seed;

      const placementStyles = {
        gold: 'ring-2 ring-yellow-400',
        silver: 'ring-2 ring-gray-300',
        bronze: 'ring-2 ring-amber-500'
      };

      const isComplete = (hasBo3Games && (() => {
        let w1 = 0, w2 = 0;
        score.games.forEach(g => {
          if (parseInt(g.s1) > parseInt(g.s2)) w1++; else if (parseInt(g.s2) > parseInt(g.s1)) w2++;
        });
        return w1 >= 2 || w2 >= 2;
      })()) || (!hasBo3Games && score.s1 !== undefined && score.s2 !== undefined && score.s1 !== '' && score.s2 !== '');

      return (
        <div className={`p-2 rounded border ${isComplete ? 'bg-gray-800 border-green-600' : t1 && t2 ? 'bg-gray-800 border-yellow-500' : 'bg-gray-800 border-gray-700'} ${match.bo3 ? 'ring-2 ring-yellow-500' : ''} ${placement ? placementStyles[placement] || '' : ''}`}>
          <div className="text-xs text-gray-500 mb-1 flex justify-between">
            <span>{match.round}</span>
            {match.bo3 && <span className="text-yellow-400">Bo3</span>}
          </div>
          <div className={`flex items-start gap-1 ${t1Won ? 'text-green-400 font-bold' : 'text-gray-300'}`}>
            <div className="flex-1 min-w-0">
              {t1 ? t1.name.split(' / ').map((p, i) => (
                <div key={i} className="text-xs leading-tight truncate">{p}</div>
              )) : <div className="text-xs">TBD</div>}
            </div>
            {hasBo3Games ? (
              <div className="flex gap-1 flex-shrink-0">
                {score.games.map((g, i) => (
                  <span key={i} className="w-7 bg-gray-700 text-center rounded text-sm">{g.s1}</span>
                ))}
              </div>
            ) : (
              <span className="w-10 text-center text-sm font-mono flex-shrink-0">{score.s1 || '-'}</span>
            )}
          </div>
          <div className={`flex items-start gap-1 mt-1 pt-1 border-t border-gray-700 ${t2Won ? 'text-green-400 font-bold' : 'text-gray-300'}`}>
            <div className="flex-1 min-w-0">
              {t2 ? t2.name.split(' / ').map((p, i) => (
                <div key={i} className="text-xs leading-tight truncate">{p}</div>
              )) : <div className="text-xs">TBD</div>}
            </div>
            {hasBo3Games ? (
              <div className="flex gap-1 flex-shrink-0">
                {score.games.map((g, i) => (
                  <span key={i} className="w-7 bg-gray-700 text-center rounded text-sm">{g.s2}</span>
                ))}
              </div>
            ) : (
              <span className="w-10 text-center text-sm font-mono flex-shrink-0">{score.s2 || '-'}</span>
            )}
          </div>
        </div>
      );
    });

    // ========== App ==========

    function App() {
      const [view, setView] = useState('home');
      const [activeTournamentId, setActiveTournamentId] = useState(null);
      const [phase, setPhase] = useState('bracket');

      // Tournament state
      const [teamCount, setTeamCount] = useState(16);
      const [rrGames, setRrGames] = useState(3);
      const [rrPointTarget, setRrPointTarget] = useState(11);
      const [winnersCount, setWinnersCount] = useState(8);
      const [teams, setTeams] = useState([]);
      const [seedingScores, setSeedingScores] = useState({});
      const [bracketScores, setBracketScores] = useState({});
      const [bracketOverrides, setBracketOverrides] = useState({});
      const [matchupsGenerated, setMatchupsGenerated] = useState(false);
      const [rrMatchups, setRrMatchups] = useState([]);
      const [pools, setPools] = useState({});
      const [bracketType, setBracketType] = useState('double');
      const [bo3Finals, setBo3Finals] = useState(true);
      const [poolSize, setPoolSize] = useState(0);
      const [bracketSeedOverride, setBracketSeedOverride] = useState(null);

      const currentPayouts = PAYOUTS[teamCount] || PAYOUTS[16];

      // Load shared state from embedded data (slim key format)
      const loadSharedState = useCallback((d) => {
        const v = (old, slim) => d[old] || d[slim];
        if (v('teamCount', 'tc')) setTeamCount(v('teamCount', 'tc'));
        if (v('rrGames', 'rg')) setRrGames(v('rrGames', 'rg'));
        if (v('rrPointTarget', 'rp')) setRrPointTarget(v('rrPointTarget', 'rp'));
        if (v('winnersCount', 'wc')) setWinnersCount(v('winnersCount', 'wc'));
        if (v('teams', 't')) setTeams(v('teams', 't'));
        if (v('seedingScores', 'ss')) setSeedingScores(v('seedingScores', 'ss'));
        if (v('bracketOverrides', 'bo')) setBracketOverrides(v('bracketOverrides', 'bo'));
        if (v('rrMatchups', 'rm')) {
          setRrMatchups(v('rrMatchups', 'rm'));
        } else {
          const g1 = v('game1Matchups', 'g1'), g2 = v('game2Matchups', 'g2'), g3 = v('game3Matchups', 'g3');
          const reconstructed = [];
          if (g1 && g1.length) reconstructed.push(g1);
          if (g2 && g2.length) reconstructed.push(g2);
          if (g3 && g3.length) reconstructed.push(g3);
          if (reconstructed.length) setRrMatchups(reconstructed);
        }
        if (v('bracketType', 'bt')) setBracketType(v('bracketType', 'bt'));
        if (v('bo3Finals', 'b3') !== undefined) setBo3Finals(v('bo3Finals', 'b3'));
        if (v('poolSize', 'ps') !== undefined) setPoolSize(v('poolSize', 'ps'));
        if (v('pools', 'p')) setPools(v('pools', 'p'));
        if (v('matchupsGenerated', 'mg')) setMatchupsGenerated(v('matchupsGenerated', 'mg'));
        if (v('bracketSeedOverride', 'bso')) setBracketSeedOverride(v('bracketSeedOverride', 'bso'));
        // Restore bracket scores: expand slim format back to full team objects
        if (d.bracketScores) {
          setBracketScores(d.bracketScores);
        } else if (d.bs) {
          const teamsArr = v('teams', 't') || [];
          const getTeam = (seed) => {
            if (!seed) return null;
            const idx = seed - 1;
            const t = teamsArr[idx];
            return t ? { seed, name: `${t.p1Name} / ${t.p2Name}` } : null;
          };
          const full = {};
          Object.entries(d.bs).forEach(([id, s]) => {
            if (s.g) {
              full[id] = { t1: getTeam(s.a), t2: getTeam(s.b), games: s.g };
            } else {
              full[id] = { t1: getTeam(s.a), t2: getTeam(s.b), s1: s.s1, s2: s.s2 };
            }
          });
          setBracketScores(full);
        }
        setPhase(v('phase', 'ph') || 'bracket');
      }, []);

      // Load a tournament by ID
      const loadTournament = useCallback((id) => {
        const tournament = TOURNAMENTS.find(t => t.id === id);
        if (!tournament) { setView('home'); return; }
        setActiveTournamentId(id);
        setView('tournament');
        window.location.hash = `t=${id}`;

        if (TOURNAMENT_STATES[id]) {
          loadSharedState(TOURNAMENT_STATES[id]);
          // Default to bracket for completed tournaments
          if (tournament.status === 'completed') {
            setPhase('bracket');
          }
          return;
        }

        // Upcoming tournament â€” no data to load, just show info
        if (tournament.teamCount) setTeamCount(tournament.teamCount);
        setTeams([]);
        setSeedingScores({});
        setBracketScores({});
        setBracketOverrides({});
        setMatchupsGenerated(false);
        setRrMatchups([]);
        setPools({});
        setBracketSeedOverride(null);
        setPhase('bracket');
      }, [loadSharedState]);

      const goHome = useCallback(() => {
        setView('home');
        setActiveTournamentId(null);
        window.location.hash = '';
      }, []);

      // Hash routing on load
      useEffect(() => {
        const hash = window.location.hash;
        if (hash.startsWith('#t=')) {
          const tournamentId = hash.substring(3);
          loadTournament(tournamentId);
        } else {
          setView('home');
        }
      }, []);

      // ========== Computed values ==========

      const getTeamName = useCallback((team) => {
        if (!team.p1Name && !team.p2Name) return '';
        if (!team.p2Name) return team.p1Name;
        if (!team.p1Name) return team.p2Name;
        return `${team.p1Name} / ${team.p2Name}`;
      }, []);

      const teamData = useMemo(() => {
        return teams.map((t, i) => ({
          seed: i + 1,
          name: getTeamName(t)
        }));
      }, [teams, getTeamName]);

      const seedingMatches = useMemo(() => {
        const t = teamData;
        if (matchupsGenerated && rrMatchups.length > 0) {
          return rrMatchups.map((roundMatchups, roundIdx) =>
            roundMatchups.map((m, i) => ({
              id: `g${roundIdx + 1}m${i}`,
              t1: t[m.t1],
              t2: t[m.t2],
              court: i + 1
            }))
          );
        }
        return [];
      }, [teamData, matchupsGenerated, rrMatchups]);

      const standings = useMemo(() => {
        const stats = {};
        teamData.forEach(t => {
          stats[t.seed] = { ...t, wins: 0, losses: 0, pf: 0, pa: 0, h2h: {}, pool: pools[t.seed - 1] };
        });

        if (rrGames === 0) {
          return Object.values(stats);
        }

        seedingMatches.flat().forEach(m => {
          const score = seedingScores[m.id];
          if (score && score.s1 !== '' && score.s2 !== '' && score.s1 !== undefined && score.s2 !== undefined) {
            const s1 = parseInt(score.s1);
            const s2 = parseInt(score.s2);
            if (!isNaN(s1) && !isNaN(s2)) {
              stats[m.t1.seed].pf += s1;
              stats[m.t1.seed].pa += s2;
              stats[m.t2.seed].pf += s2;
              stats[m.t2.seed].pa += s1;

              if (s1 > s2) {
                stats[m.t1.seed].wins++;
                stats[m.t2.seed].losses++;
                stats[m.t1.seed].h2h[m.t2.seed] = { result: 1, pf: s1, pa: s2 };
                stats[m.t2.seed].h2h[m.t1.seed] = { result: -1, pf: s2, pa: s1 };
              } else if (s2 > s1) {
                stats[m.t2.seed].wins++;
                stats[m.t1.seed].losses++;
                stats[m.t2.seed].h2h[m.t1.seed] = { result: 1, pf: s2, pa: s1 };
                stats[m.t1.seed].h2h[m.t2.seed] = { result: -1, pf: s1, pa: s2 };
              }
            }
          }
        });

        // 3-way tiebreaker: group h2h within tied teams, then group PD, then overall PD
        const resolveTiedGroup = (group) => {
          if (group.length <= 1) return group;

          let allPlayedEachOther = true;
          for (let i = 0; i < group.length && allPlayedEachOther; i++) {
            for (let j = i + 1; j < group.length && allPlayedEachOther; j++) {
              if (!group[i].h2h[group[j].seed]) {
                allPlayedEachOther = false;
              }
            }
          }

          if (!allPlayedEachOther) {
            return [...group].sort((a, b) => ((b.pf - b.pa) - (a.pf - a.pa)) || (a.seed - b.seed));
          }

          const withG = group.map(t => {
            let gW = 0, gPf = 0, gPa = 0;
            group.forEach(o => {
              if (t.seed === o.seed) return;
              const h = t.h2h[o.seed];
              if (h) {
                if (h.result === 1) gW++;
                gPf += h.pf || 0;
                gPa += h.pa || 0;
              }
            });
            return { ...t, gW, gPd: gPf - gPa };
          });
          withG.sort((a, b) => {
            if (b.gW !== a.gW) return b.gW - a.gW;
            if (b.gPd !== a.gPd) return b.gPd - a.gPd;
            if ((b.pf - b.pa) !== (a.pf - a.pa)) return (b.pf - b.pa) - (a.pf - a.pa);
            return a.seed - b.seed;
          });
          const result = [];
          let si = 0;
          while (si < withG.length) {
            let sj = si + 1;
            while (sj < withG.length && withG[sj].gW === withG[si].gW && withG[sj].gPd === withG[si].gPd) sj++;
            const sub = withG.slice(si, sj);
            if (sub.length > 1 && sub.length < group.length) {
              result.push(...resolveTiedGroup(sub));
            } else {
              result.push(...sub);
            }
            si = sj;
          }
          return result;
        };

        const allTeams = Object.values(stats).sort((a, b) => b.wins - a.wins);
        const resolved = [];
        let gi = 0;
        while (gi < allTeams.length) {
          let gj = gi + 1;
          while (gj < allTeams.length && allTeams[gj].wins === allTeams[gi].wins) gj++;
          resolved.push(...resolveTiedGroup(allTeams.slice(gi, gj)));
          gi = gj;
        }
        return resolved;
      }, [teamData, seedingScores, seedingMatches, rrGames, pools]);

      const displayStandings = standings;

      const bracketTeams = useMemo(() => {
        if (bracketSeedOverride) {
          return { winners: bracketSeedOverride.winners, losers: bracketSeedOverride.losers };
        }
        if (displayStandings.length < teamCount) return { winners: [], losers: [] };

        const losersCount = teamCount - winnersCount;
        let winners, losers;
        const uniquePools = [...new Set(Object.values(pools))];
        if (uniquePools.length > 1 && winnersCount > 0) {
          const perPool = Math.floor(winnersCount / uniquePools.length);
          const winnersSet = new Set();
          const poolCounts = {};
          uniquePools.forEach(p => poolCounts[p] = 0);
          for (const team of displayStandings) {
            const p = team.pool;
            if (p !== undefined && poolCounts[p] !== undefined && poolCounts[p] < perPool) {
              winnersSet.add(team.seed);
              poolCounts[p]++;
            }
          }
          for (const team of displayStandings) {
            if (winnersSet.size >= winnersCount) break;
            if (!winnersSet.has(team.seed)) winnersSet.add(team.seed);
          }
          winners = displayStandings.filter(t => winnersSet.has(t.seed));
          losers = displayStandings.filter(t => !winnersSet.has(t.seed));
        } else {
          winners = displayStandings.slice(0, winnersCount);
          losers = displayStandings.slice(winnersCount);
        }
        return { winners, losers };
      }, [displayStandings, teamCount, winnersCount, bracketSeedOverride, pools]);

      const resolveTeam = useCallback((team) => {
        if (!team || !team.placeholder) return team;
        const real = displayStandings.find(t => t.seed === team.seed);
        return real || team;
      }, [displayStandings]);

      const getBracketMatchTeam = useCallback((id) => {
        if (bracketOverrides[id] && bracketOverrides[id].winner) {
          return resolveTeam(bracketOverrides[id].winner);
        }
        const score = bracketScores[id];
        if (!score) return null;

        if (score.games && score.games.length > 0) {
          let t1Wins = 0, t2Wins = 0;
          score.games.forEach(g => {
            const s1v = parseInt(g.s1), s2v = parseInt(g.s2);
            if (!isNaN(s1v) && !isNaN(s2v)) {
              if (s1v > s2v) t1Wins++;
              else if (s2v > s1v) t2Wins++;
            }
          });
          if (t1Wins >= 2) return resolveTeam(score.t1);
          if (t2Wins >= 2) return resolveTeam(score.t2);
          return null;
        }

        if (score.s1 === '' || score.s2 === '' || score.s1 === undefined || score.s2 === undefined) return null;
        return parseInt(score.s1) > parseInt(score.s2) ? resolveTeam(score.t1) : resolveTeam(score.t2);
      }, [bracketScores, bracketOverrides, resolveTeam]);

      const getBracketMatchLoser = useCallback((id) => {
        if (bracketOverrides[id] && bracketOverrides[id].loser) {
          return resolveTeam(bracketOverrides[id].loser);
        }
        const score = bracketScores[id];
        if (!score) return null;

        if (score.games && score.games.length > 0) {
          let t1Wins = 0, t2Wins = 0;
          score.games.forEach(g => {
            const s1v = parseInt(g.s1), s2v = parseInt(g.s2);
            if (!isNaN(s1v) && !isNaN(s2v)) {
              if (s1v > s2v) t1Wins++;
              else if (s2v > s1v) t2Wins++;
            }
          });
          if (t1Wins >= 2) return resolveTeam(score.t2);
          if (t2Wins >= 2) return resolveTeam(score.t1);
          return null;
        }

        if (score.s1 === '' || score.s2 === '' || score.s1 === undefined || score.s2 === undefined) return null;
        return parseInt(score.s1) > parseInt(score.s2) ? resolveTeam(score.t2) : resolveTeam(score.t1);
      }, [bracketScores, bracketOverrides, resolveTeam]);

      const allSeedingComplete = useMemo(() => {
        if (rrGames === 0 && matchupsGenerated) return true;
        const allMatches = seedingMatches.flat();
        if (!allMatches.length) return false;
        return allMatches.every(m => {
          const s = seedingScores[m.id];
          return s && s.s1 !== '' && s.s2 !== '' && s.s1 !== undefined && s.s2 !== undefined;
        });
      }, [seedingMatches, seedingScores, rrGames, matchupsGenerated]);

      const bracketMatches = useMemo(() => {
        const w = bracketTeams.winners || [];
        const l = bracketTeams.losers || [];

        // ========= SINGLE ELIMINATION =========
        if (bracketType === 'single') {
          const seTeams = displayStandings.slice(0, teamCount);
          if (seTeams.length < 2) return {};
          const matches = {};
          const n = seTeams.length;
          const qfSeeds = [[0,7],[3,4],[1,6],[2,5]];

          if (n > 8) {
            const piSeeds = [[8,15],[11,12],[9,14],[10,13]];
            piSeeds.forEach((pair, i) => {
              const t1 = pair[0] < n ? seTeams[pair[0]] : null;
              const t2 = pair[1] < n ? seTeams[pair[1]] : null;
              if (t1 && t2) {
                matches[`se_r1m${i+1}`] = { id: `se_r1m${i+1}`, t1, t2, round: 'R1', court: i + 1 };
              } else if (t1) {
                matches[`se_r1m${i+1}`] = { id: `se_r1m${i+1}`, t1, t2: null, round: 'R1 (bye)', bye: true };
              }
            });
            qfSeeds.forEach((pair, i) => {
              const topSeed = seTeams[pair[0]];
              const piId = `se_r1m${i+1}`;
              const piMatch = matches[piId];
              const opponent = pair[1] < 8 ? seTeams[pair[1]] : (piMatch?.bye ? piMatch?.t1 : getBracketMatchTeam(piId));
              matches[`se_qf${i+1}`] = { id: `se_qf${i+1}`, t1: topSeed, t2: opponent, round: 'QF' };
            });
          } else {
            qfSeeds.forEach((pair, i) => {
              const t1 = pair[0] < n ? seTeams[pair[0]] : null;
              const t2 = pair[1] < n ? seTeams[pair[1]] : null;
              if (t1 && t2) {
                matches[`se_qf${i+1}`] = { id: `se_qf${i+1}`, t1, t2, round: 'QF', court: i + 1 };
              } else if (t1) {
                matches[`se_qf${i+1}`] = { id: `se_qf${i+1}`, t1, t2: null, round: 'QF (bye)', bye: true };
              }
            });
          }

          const getQfWinner = (id) => matches[id]?.bye ? matches[id]?.t1 : getBracketMatchTeam(id);
          matches.se_sf1 = { id: 'se_sf1', t1: getQfWinner('se_qf1'), t2: getQfWinner('se_qf2'), round: 'SF' };
          matches.se_sf2 = { id: 'se_sf2', t1: getQfWinner('se_qf3'), t2: getQfWinner('se_qf4'), round: 'SF' };
          matches.se_f = { id: 'se_f', t1: getBracketMatchTeam('se_sf1'), t2: getBracketMatchTeam('se_sf2'), round: 'Final', bo3: bo3Finals };
          matches.se_3rd = { id: 'se_3rd', t1: getBracketMatchLoser('se_sf1'), t2: getBracketMatchLoser('se_sf2'), round: '3rd Place' };
          return matches;
        }

        // ========= DOUBLE ELIMINATION =========
        if (w.length < 4) return {};
        const matches = {};

        if (w.length >= 8) {
          matches.wqf1 = { id: 'wqf1', t1: w[0], t2: w[7], round: 'W-QF', court: 1 };
          matches.wqf2 = { id: 'wqf2', t1: w[3], t2: w[4], round: 'W-QF', court: 2 };
          matches.wqf3 = { id: 'wqf3', t1: w[1], t2: w[6], round: 'W-QF', court: 3 };
          matches.wqf4 = { id: 'wqf4', t1: w[2], t2: w[5], round: 'W-QF', court: 4 };
        } else if (w.length >= 6) {
          matches.wqf1 = { id: 'wqf1', t1: w[0], t2: w.length > 7 ? w[7] : null, round: w.length > 7 ? 'W-QF' : 'W-QF (bye)', bye: w.length <= 7 };
          matches.wqf2 = { id: 'wqf2', t1: w[3], t2: w[4], round: 'W-QF', court: 2 };
          matches.wqf3 = { id: 'wqf3', t1: w[1], t2: w.length > 6 ? w[6] : null, round: w.length > 6 ? 'W-QF' : 'W-QF (bye)', bye: w.length <= 6 };
          matches.wqf4 = { id: 'wqf4', t1: w[2], t2: w[5], round: 'W-QF', court: 4 };
        } else {
          matches.wqf1 = { id: 'wqf1', t1: w[0], t2: w.length > 3 ? w[3] : null, round: w.length > 3 ? 'W-QF' : 'W-QF (bye)', bye: w.length <= 3, court: 1 };
          matches.wqf2 = { id: 'wqf2', t1: w[1], t2: w[2], round: 'W-QF', court: 2 };
          matches.wqf3 = { id: 'wqf3', t1: w.length > 4 ? w[4] : null, t2: null, round: 'W-QF (bye)', bye: true };
          matches.wqf4 = { id: 'wqf4', t1: null, t2: null, round: 'W-QF (bye)', bye: true };
        }

        const getWqfWinner = (id) => matches[id]?.bye ? matches[id]?.t1 : getBracketMatchTeam(id);
        matches.wsf1 = { id: 'wsf1', t1: getWqfWinner('wqf1'), t2: getWqfWinner('wqf2'), round: 'W-SF' };
        matches.wsf2 = { id: 'wsf2', t1: getWqfWinner('wqf3'), t2: getWqfWinner('wqf4'), round: 'W-SF' };
        matches.wf = { id: 'wf', t1: getBracketMatchTeam('wsf1'), t2: getBracketMatchTeam('wsf2'), round: 'W-Final', bo3: bo3Finals };

        // Losers bracket (crossed drops to prevent rematches)
        if (l.length >= 8) {
          matches.lr1m1 = { id: 'lr1m1', t1: l[0], t2: l[7], round: 'L-R1', court: 5 };
          matches.lr1m2 = { id: 'lr1m2', t1: l[3], t2: l[4], round: 'L-R1', court: 6 };
          matches.lr1m3 = { id: 'lr1m3', t1: l[1], t2: l[6], round: 'L-R1', court: 7 };
          matches.lr1m4 = { id: 'lr1m4', t1: l[2], t2: l[5], round: 'L-R1', court: 8 };
          matches.lr2m1 = { id: 'lr2m1', t1: getBracketMatchTeam('lr1m1'), t2: getBracketMatchLoser('wqf3'), round: 'L-R2' };
          matches.lr2m2 = { id: 'lr2m2', t1: getBracketMatchTeam('lr1m2'), t2: getBracketMatchLoser('wqf4'), round: 'L-R2' };
          matches.lr2m3 = { id: 'lr2m3', t1: getBracketMatchTeam('lr1m3'), t2: getBracketMatchLoser('wqf1'), round: 'L-R2' };
          matches.lr2m4 = { id: 'lr2m4', t1: getBracketMatchTeam('lr1m4'), t2: getBracketMatchLoser('wqf2'), round: 'L-R2' };
          matches.lr3m1 = { id: 'lr3m1', t1: getBracketMatchTeam('lr2m1'), t2: getBracketMatchTeam('lr2m2'), round: 'L-R3' };
          matches.lr3m2 = { id: 'lr3m2', t1: getBracketMatchTeam('lr2m3'), t2: getBracketMatchTeam('lr2m4'), round: 'L-R3' };
          matches.lr4m1 = { id: 'lr4m1', t1: getBracketMatchTeam('lr3m1'), t2: getBracketMatchLoser('wsf1'), round: 'L-R4' };
          matches.lr4m2 = { id: 'lr4m2', t1: getBracketMatchTeam('lr3m2'), t2: getBracketMatchLoser('wsf2'), round: 'L-R4' };
          matches.lsf = { id: 'lsf', t1: getBracketMatchTeam('lr4m1'), t2: getBracketMatchTeam('lr4m2'), round: 'L-Semi' };
          matches.lf = { id: 'lf', t1: getBracketMatchTeam('lsf'), t2: getBracketMatchLoser('wf'), round: 'L-Final' };
        } else if (l.length === 0) {
          matches.lr2m1 = { id: 'lr2m1', t1: getBracketMatchLoser('wqf1'), t2: getBracketMatchLoser('wqf2'), round: 'L-R2' };
          matches.lr2m2 = { id: 'lr2m2', t1: getBracketMatchLoser('wqf3'), t2: getBracketMatchLoser('wqf4'), round: 'L-R2' };
          matches.lr3m1 = { id: 'lr3m1', t1: getBracketMatchTeam('lr2m1'), t2: getBracketMatchLoser('wsf2'), round: 'L-R3' };
          matches.lr3m2 = { id: 'lr3m2', t1: getBracketMatchTeam('lr2m2'), t2: getBracketMatchLoser('wsf1'), round: 'L-R3' };
          matches.lsf = { id: 'lsf', t1: getBracketMatchTeam('lr3m1'), t2: getBracketMatchTeam('lr3m2'), round: 'L-Semi' };
          matches.lf = { id: 'lf', t1: getBracketMatchTeam('lsf'), t2: getBracketMatchLoser('wf'), round: 'L-Final' };
        } else if (l.length >= 4) {
          matches.lr1m1 = { id: 'lr1m1', t1: l[0], t2: l.length > 3 ? l[3] : null, round: l.length > 3 ? 'L-R1' : 'L-R1 (bye)', court: 5, bye: l.length <= 3 };
          matches.lr1m2 = { id: 'lr1m2', t1: l[1], t2: l[2], round: 'L-R1', court: 6 };
          if (l.length > 4) {
            matches.lr1m3 = { id: 'lr1m3', t1: l[4], t2: l.length > 5 ? l[5] : null, round: l.length > 5 ? 'L-R1' : 'L-R1 (bye)', court: 7, bye: l.length <= 5 };
          }
          if (l.length > 6) {
            matches.lr1m4 = { id: 'lr1m4', t1: l[6], t2: l.length > 7 ? l[7] : null, round: l.length > 7 ? 'L-R1' : 'L-R1 (bye)', court: 8, bye: l.length <= 7 };
          }
          const getLr1Win = (id) => matches[id]?.bye ? matches[id]?.t1 : getBracketMatchTeam(id);
          const getWqfLos = (id) => matches[id]?.bye ? null : getBracketMatchLoser(id);
          matches.lr2m1 = { id: 'lr2m1', t1: getLr1Win('lr1m1'), t2: getWqfLos('wqf3'), round: 'L-R2' };
          matches.lr2m2 = { id: 'lr2m2', t1: getLr1Win('lr1m2'), t2: getWqfLos('wqf4'), round: 'L-R2' };
          if (matches.lr1m3) matches.lr2m3 = { id: 'lr2m3', t1: getLr1Win('lr1m3'), t2: getWqfLos('wqf1'), round: 'L-R2' };
          if (matches.lr1m4) matches.lr2m4 = { id: 'lr2m4', t1: getLr1Win('lr1m4'), t2: getWqfLos('wqf2'), round: 'L-R2' };
          matches.lr3m1 = { id: 'lr3m1', t1: getBracketMatchTeam('lr2m1'), t2: getBracketMatchTeam('lr2m2'), round: 'L-R3' };
          if (matches.lr2m3 && matches.lr2m4) matches.lr3m2 = { id: 'lr3m2', t1: getBracketMatchTeam('lr2m3'), t2: getBracketMatchTeam('lr2m4'), round: 'L-R3' };
          if (matches.lr3m2) {
            matches.lr4m1 = { id: 'lr4m1', t1: getBracketMatchTeam('lr3m1'), t2: getBracketMatchLoser('wsf1'), round: 'L-R4' };
            matches.lr4m2 = { id: 'lr4m2', t1: getBracketMatchTeam('lr3m2'), t2: getBracketMatchLoser('wsf2'), round: 'L-R4' };
            matches.lsf = { id: 'lsf', t1: getBracketMatchTeam('lr4m1'), t2: getBracketMatchTeam('lr4m2'), round: 'L-Semi' };
          } else {
            matches.lr4m1 = { id: 'lr4m1', t1: getBracketMatchTeam('lr3m1'), t2: getBracketMatchLoser('wsf1'), round: 'L-R4' };
            matches.lsf = { id: 'lsf', t1: getBracketMatchTeam('lr4m1'), t2: getBracketMatchLoser('wsf2'), round: 'L-Semi' };
          }
          matches.lf = { id: 'lf', t1: getBracketMatchTeam('lsf'), t2: getBracketMatchLoser('wf'), round: 'L-Final' };
        } else {
          matches.lf = { id: 'lf', t1: getBracketMatchLoser('wsf1'), t2: getBracketMatchLoser('wf'), round: 'L-Final' };
        }

        matches.gf = { id: 'gf', t1: getBracketMatchTeam('wf'), t2: getBracketMatchTeam('lf'), round: 'Grand Final', bo3: bo3Finals };
        const gfWinnerTeam = getBracketMatchTeam('gf');
        const wfWinnerTeam = getBracketMatchTeam('wf');
        if (gfWinnerTeam && wfWinnerTeam && gfWinnerTeam.seed !== wfWinnerTeam.seed) {
          matches.gf2 = { id: 'gf2', t1: matches.gf.t1, t2: matches.gf.t2, round: 'Game to 15' };
        } else if (bracketScores['gf2'] && bracketScores['gf2'].s1 !== undefined) {
          matches.gf2 = { id: 'gf2', t1: matches.gf.t1, t2: matches.gf.t2, round: 'Game to 15' };
        }
        return matches;
      }, [bracketTeams, displayStandings, bracketType, teamCount, bo3Finals, getBracketMatchTeam, getBracketMatchLoser, allSeedingComplete, matchupsGenerated, rrGames, pools, winnersCount, bracketScores, bracketOverrides]);

      const finalMatchId = bracketType === 'single' ? 'se_f' : (bracketMatches['gf2'] ? 'gf2' : 'gf');
      const thirdMatchId = bracketType === 'single' ? 'se_3rd' : 'lf';
      const gfWinner = getBracketMatchTeam(finalMatchId);

      // ========== Render helpers ==========

      const renderMatch = (id) => {
        const m = bracketMatches[id];
        if (!m || m.bye) return null;
        return (
          <BracketMatch
            key={id}
            match={m}
            score={bracketScores[id] || {}}
            winner={getBracketMatchTeam(id)}
          />
        );
      };

      const col = (label, ids, opts = {}) => {
        const validIds = ids.filter(id => bracketMatches[id] && !bracketMatches[id].bye);
        if (!validIds.length) return null;
        return (
          <div className={`space-y-2 w-44 flex-shrink-0 ${opts.pt || ''}`}>
            <div className="text-xs text-gray-500 text-center">{label}</div>
            {validIds.map((id, idx) => (
              <React.Fragment key={id}>
                {renderMatch(id)}
                {opts.gap && idx < validIds.length - 1 && <div className={opts.gap}></div>}
              </React.Fragment>
            ))}
          </div>
        );
      };

      // ========== Render ==========

      return (
        <div className="bg-gray-900 text-white p-4 min-h-screen">

          {/* ============ HOME PAGE ============ */}
          {view === 'home' && (
            <div className="max-w-3xl mx-auto">
              <h1 className="text-3xl font-bold text-center mb-1 mt-6">{'\u{1F3D3}'} Jordan's Moneyballs</h1>
              <p className="text-center text-gray-400 text-sm mb-8">Bounce Philly</p>

              <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mb-6">
                {TOURNAMENTS.map(tournament => (
                  <div
                    key={tournament.id}
                    onClick={() => tournament.status !== 'upcoming' ? loadTournament(tournament.id) : null}
                    className={`bg-gray-800 border border-gray-700 rounded-lg p-5 transition-all group ${
                      tournament.status !== 'upcoming' ? 'cursor-pointer hover:border-orange-500 hover:bg-gray-700' : 'opacity-80'
                    }`}
                  >
                    <div className="flex justify-between items-start mb-2">
                      <span className="text-gray-400 text-sm">{tournament.date}</span>
                      <span className={`text-xs px-2 py-0.5 rounded-full ${
                        tournament.status === 'completed' ? 'bg-green-900 text-green-400' :
                        tournament.status === 'upcoming' ? 'bg-blue-900 text-blue-400' :
                        'bg-yellow-900 text-yellow-400'
                      }`}>
                        {tournament.status}
                      </span>
                    </div>
                    <h3 className={`text-lg font-semibold text-white ${tournament.status !== 'upcoming' ? 'group-hover:text-orange-400' : ''} transition-colors`}>{tournament.title}</h3>
                    {tournament.results && (
                      <div className="mt-2 space-y-0.5">
                        <div className="text-xs flex items-center gap-1"><span>{'\u{1F947}'}</span><span className="text-yellow-300">{tournament.results.first}</span></div>
                        <div className="text-xs flex items-center gap-1"><span>{'\u{1F948}'}</span><span className="text-gray-300">{tournament.results.second}</span></div>
                        <div className="text-xs flex items-center gap-1"><span>{'\u{1F949}'}</span><span className="text-amber-400">{tournament.results.third}</span></div>
                      </div>
                    )}
                    {tournament.status === 'upcoming' && tournament.teamCount && (
                      <p className="text-gray-500 text-xs mt-1">{tournament.teamCount} teams registered</p>
                    )}
                  </div>
                ))}
              </div>

              <div className="text-center mt-8">
                <a href="Jordan_Moneyball.html" className="text-gray-600 text-xs hover:text-gray-400 transition-colors">
                  Organizer Login
                </a>
              </div>
            </div>
          )}

          {/* ============ TOURNAMENT DETAIL VIEW ============ */}
          {view === 'tournament' && (
            <>
              <div className="flex items-center justify-between mb-3 max-w-6xl mx-auto">
                <button onClick={goHome} className="text-sm text-gray-400 hover:text-white flex items-center gap-1">
                  {'\u2190'} All Tournaments
                </button>
                <span className="text-gray-500 text-xs">
                  {TOURNAMENTS.find(t => t.id === activeTournamentId)?.title || 'Tournament'}
                </span>
              </div>

              <h1 className="text-2xl font-bold text-center mb-1">{'\u{1F3D3}'} Jordan's Moneyballs</h1>
              <p className="text-center text-gray-400 text-xs mb-2">$45/player {'\u2022'} {'\u{1F947}'} ${currentPayouts.first} {'\u{1F948}'} ${currentPayouts.second} {'\u{1F949}'} ${currentPayouts.third}</p>

              {/* Tabs */}
              <div className="flex justify-center gap-2 mb-4 flex-wrap">
                {(rrGames > 0 || poolSize > 0) && seedingMatches.length > 0 && (
                  <button onClick={() => setPhase('roundrobin')} className={`px-3 py-1 rounded text-sm ${phase === 'roundrobin' ? 'bg-blue-600' : 'bg-gray-700'}`}>Round Robin</button>
                )}
                {(rrGames > 0 || poolSize > 0) && standings.length > 0 && (
                  <button onClick={() => setPhase('standings')} className={`px-3 py-1 rounded text-sm ${phase === 'standings' ? 'bg-cyan-600' : 'bg-gray-700'}`}>Standings</button>
                )}
                {Object.keys(bracketMatches).length > 0 && (
                  <button onClick={() => setPhase('bracket')} className={`px-3 py-1 rounded text-sm ${phase === 'bracket' ? 'bg-green-600' : 'bg-gray-700'}`}>Bracket</button>
                )}
                {gfWinner && (
                  <button onClick={() => setPhase('results')} className={`px-3 py-1 rounded text-sm ${phase === 'results' ? 'bg-yellow-600' : 'bg-gray-700'}`}>Results</button>
                )}
              </div>

              {/* ====== ROUND ROBIN TAB ====== */}
              {phase === 'roundrobin' && (
                <div className="max-w-6xl mx-auto">
                  <h2 className="text-xl font-semibold mb-2">Round Robin ({teamCount} teams, {seedingMatches.length} games to {rrPointTarget})</h2>

                  {Object.keys(pools).length > 0 && (() => {
                    const numPools = Math.max(...Object.values(pools)) + 1;
                    const poolColors = ['#facc15', '#60a5fa', '#4ade80', '#f87171', '#c084fc', '#fb923c', '#22d3ee', '#f472b6'];
                    return (
                      <div className="mb-4 bg-gray-800 rounded p-3">
                        <div className="text-sm font-semibold mb-2">Pool Assignments</div>
                        <div className="grid gap-2 text-xs grid-cols-2 sm:grid-cols-4">
                          {Array.from({ length: numPools }, (_, poolIdx) => (
                            <div key={poolIdx} className="bg-gray-700 rounded p-2">
                              <div className="font-semibold text-center mb-1" style={{ color: poolColors[poolIdx % poolColors.length] }}>
                                Pool {String.fromCharCode(65 + poolIdx)}
                              </div>
                              {Object.entries(pools).filter(([_, p]) => p === poolIdx).map(([teamIdx]) => (
                                <div key={teamIdx} className="text-gray-300 mb-1">
                                  <span className="font-mono">{parseInt(teamIdx) + 1}.</span> {teams[teamIdx]?.p1Name?.split(' ')[0]} / {teams[teamIdx]?.p2Name?.split(' ')[0]}
                                </div>
                              ))}
                            </div>
                          ))}
                        </div>
                      </div>
                    );
                  })()}

                  {/* Pool-based layout */}
                  {Object.keys(pools).length > 0 ? (() => {
                    const numPools = Math.max(...Object.values(pools)) + 1;
                    const poolColors = ['#facc15', '#60a5fa', '#4ade80', '#f87171', '#c084fc', '#fb923c', '#22d3ee', '#f472b6'];
                    return (
                      <div className="flex gap-4 overflow-x-auto pb-2">
                        {Array.from({ length: numPools }, (_, poolIdx) => {
                          const poolColor = poolColors[poolIdx % poolColors.length];
                          return (
                            <div key={poolIdx} className="rounded-lg p-2 flex-shrink-0" style={{ backgroundColor: poolColor + '10', border: `1px solid ${poolColor}33`, minWidth: '260px', width: `${100 / numPools}%` }}>
                              <h3 className="font-semibold mb-1 text-center" style={{ color: poolColor }}>
                                Pool {String.fromCharCode(65 + poolIdx)}
                              </h3>
                              <div className="space-y-2">
                                {seedingMatches.map((roundMatches, roundIdx) => {
                                  const poolMatches = roundMatches.filter(m => pools[m.t1.seed - 1] === poolIdx);
                                  return poolMatches.map(m => (
                                    <div key={m.id}>
                                      <div className="text-xs text-gray-500 mb-1">Game {roundIdx + 1}</div>
                                      <SeedingMatch match={m} score={seedingScores[m.id] || {}} poolColor={poolColor} />
                                    </div>
                                  ));
                                })}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    );
                  })() : (
                    /* Game-based layout */
                    <div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${Math.min(seedingMatches.length, 4)}, 1fr)` }}>
                      {seedingMatches.map((roundMatches, roundIdx) => {
                        const colors = ['text-blue-400', 'text-green-400', 'text-yellow-400', 'text-red-400', 'text-purple-400', 'text-pink-400', 'text-cyan-400'];
                        return (
                          <div key={roundIdx}>
                            <h3 className={`${colors[roundIdx % colors.length]} font-semibold mb-2 text-center`}>Game {roundIdx + 1}</h3>
                            <div className="space-y-2">
                              {roundMatches.map(m => (
                                <SeedingMatch key={m.id} match={m} score={seedingScores[m.id] || {}} />
                              ))}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              )}

              {/* ====== STANDINGS TAB ====== */}
              {phase === 'standings' && (
                <div className="max-w-2xl mx-auto">
                  <h2 className="text-xl font-semibold text-center mb-4">Standings</h2>
                  <div className="bg-gray-800 rounded p-3">
                    <div className="text-xs text-gray-500 flex px-2 mb-2">
                      <span className="w-8">Rk</span>
                      {Object.keys(pools).length > 0 && <span className="w-10">Pool</span>}
                      <span className="flex-1">Team</span>
                      <span className="w-12 text-center">W-L</span>
                      <span className="w-12 text-center">PF</span>
                      <span className="w-12 text-center">PA</span>
                      <span className="w-12 text-right">PD</span>
                    </div>
                    {displayStandings.map((t, i) => {
                      const isWinners = bracketType === 'single' || i < winnersCount;
                      const poolColorClasses = ['text-yellow-400', 'text-blue-400', 'text-green-400', 'text-red-400'];
                      return (
                        <div key={t.seed} className={`flex items-center text-sm py-2 px-2 rounded mb-1 ${isWinners ? 'bg-blue-900/30' : 'bg-red-900/30'}`}>
                          <span className={`w-8 font-bold ${isWinners ? 'text-blue-400' : 'text-red-400'}`}>{i + 1}</span>
                          {Object.keys(pools).length > 0 && (
                            <span className={`w-10 text-xs ${poolColorClasses[t.pool] || 'text-gray-400'}`}>
                              {t.pool !== undefined ? String.fromCharCode(65 + t.pool) : '-'}
                            </span>
                          )}
                          <span className="flex-1 truncate">{t.name}</span>
                          <span className="w-12 text-center">{t.wins}-{t.losses}</span>
                          <span className="w-12 text-center text-gray-400">{t.pf}</span>
                          <span className="w-12 text-center text-gray-400">{t.pa}</span>
                          <span className={`w-12 text-right ${t.pf - t.pa > 0 ? 'text-green-400' : t.pf - t.pa < 0 ? 'text-red-400' : ''}`}>
                            {t.pf - t.pa > 0 ? '+' : ''}{t.pf - t.pa}
                          </span>
                        </div>
                      );
                    })}
                  </div>
                  <div className="mt-2 text-xs text-gray-500 text-center">
                    {bracketType === 'single'
                      ? `All ${teamCount} teams \u2192 Single Elimination Bracket`
                      : winnersCount === teamCount
                        ? `All ${teamCount} teams \u2192 Winners Bracket`
                        : `Top ${winnersCount} \u2192 Winners Bracket | Bottom ${teamCount - winnersCount} \u2192 Losers Bracket`}
                  </div>
                </div>
              )}

              {/* ====== BRACKET TAB ====== */}
              {phase === 'bracket' && (
                <div className="max-w-6xl mx-auto overflow-x-auto">
                  <h2 className="text-lg font-semibold text-blue-400 mb-2">{bracketType === 'single' ? 'Single Elimination' : 'Winners Bracket'}</h2>

                  {/* Single Elimination Layout */}
                  {bracketType === 'single' && (
                    <div className="flex gap-3 pb-4">
                      {teamCount > 8 && col('R1', ['se_r1m1','se_r1m2','se_r1m3','se_r1m4'])}
                      {col('QF', ['se_qf1','se_qf2','se_qf3','se_qf4'])}
                      {col('SF', ['se_sf1','se_sf2'], { pt: 'pt-10', gap: 'h-12' })}
                      <div className="w-48 flex-shrink-0 pt-16">
                        <div className="text-xs text-gray-500 text-center">Final</div>
                        {renderMatch('se_f')}
                        {getBracketMatchTeam('se_f') && (
                          <div className="mt-3 bg-gradient-to-r from-yellow-700 to-yellow-600 p-3 rounded text-center border-2 border-yellow-400">
                            <div className="text-xs text-yellow-200">{'\u{1F947}'} CHAMPION {'\u2014'} ${currentPayouts.first}</div>
                            {getBracketMatchTeam('se_f').name.split(' / ').map((p, i) => (
                              <div key={i} className="text-sm font-bold text-white">{p}</div>
                            ))}
                          </div>
                        )}
                        {getBracketMatchLoser('se_f') && (
                          <div className="mt-2 bg-gradient-to-r from-gray-500 to-gray-400 p-2 rounded text-center border border-gray-300">
                            <div className="text-xs text-gray-200">{'\u{1F948}'} 2nd Place {'\u2014'} ${currentPayouts.second}</div>
                            {getBracketMatchLoser('se_f').name.split(' / ').map((p, i) => (
                              <div key={i} className="text-xs font-semibold text-white">{p}</div>
                            ))}
                          </div>
                        )}
                        <div className="mt-4">
                          <div className="text-xs text-gray-500 text-center mb-1">3rd Place Match</div>
                          {renderMatch('se_3rd')}
                          {getBracketMatchTeam('se_3rd') && (
                            <div className="mt-2 bg-gradient-to-r from-amber-800 to-amber-700 p-2 rounded text-center border border-amber-500">
                              <div className="text-xs text-amber-200">{'\u{1F949}'} 3rd Place {'\u2014'} ${currentPayouts.third}</div>
                              {getBracketMatchTeam('se_3rd').name.split(' / ').map((p, i) => (
                                <div key={i} className="text-xs font-semibold text-white">{p}</div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Double Elimination Layout */}
                  {bracketType === 'double' && (
                    <>
                      <div className="flex gap-3 pb-4">
                        {col('W-QF', ['wqf1','wqf2','wqf3','wqf4'])}
                        {col('W-SF', ['wsf1','wsf2'], { pt: 'pt-10', gap: 'h-12' })}
                        <div className="w-44 flex-shrink-0 pt-20">
                          <div className="text-xs text-gray-500 text-center">W-Final</div>
                          {renderMatch('wf')}
                        </div>
                        <div className="w-56 flex-shrink-0 pt-16">
                          <h3 className="text-yellow-400 font-semibold mb-2 text-center text-sm">{'\u{1F3C6}'} Grand Final</h3>
                          {renderMatch('gf')}
                          {bracketMatches['gf2'] && (
                            <div className="mt-2">
                              <div className="text-xs text-yellow-400 text-center mb-1">Game to 15</div>
                              {renderMatch('gf2')}
                            </div>
                          )}
                          {gfWinner && (
                            <div className="mt-3 bg-gradient-to-r from-yellow-700 to-yellow-600 p-3 rounded text-center border-2 border-yellow-400">
                              <div className="text-xs text-yellow-200">{'\u{1F947}'} CHAMPION {'\u2014'} ${currentPayouts.first}</div>
                              {gfWinner.name.split(' / ').map((p, i) => (
                                <div key={i} className="text-sm font-bold text-white">{p}</div>
                              ))}
                            </div>
                          )}
                          {getBracketMatchLoser(finalMatchId) && (
                            <div className="mt-2 bg-gradient-to-r from-gray-500 to-gray-400 p-2 rounded text-center border border-gray-300">
                              <div className="text-xs text-gray-200">{'\u{1F948}'} 2nd Place {'\u2014'} ${currentPayouts.second}</div>
                              {getBracketMatchLoser(finalMatchId).name.split(' / ').map((p, i) => (
                                <div key={i} className="text-xs font-semibold text-white">{p}</div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <h2 className="text-lg font-semibold text-red-400 mb-2">Losers Bracket</h2>
                      <div className="flex gap-3 pb-4 overflow-x-auto">
                        {col('L-R1', ['lr1m1','lr1m2','lr1m3','lr1m4'])}
                        {col('L-R2', ['lr2m1','lr2m2','lr2m3','lr2m4'])}
                        {col('L-R3', ['lr3m1','lr3m2'], { pt: 'pt-10', gap: 'h-6' })}
                        {col('L-R4', ['lr4m1','lr4m2'], { pt: 'pt-10', gap: 'h-6' })}
                        <div className="w-44 flex-shrink-0 pt-14">
                          <div className="text-xs text-gray-500 text-center">L-Semi</div>
                          {renderMatch('lsf')}
                        </div>
                        <div className="w-44 flex-shrink-0 pt-14">
                          <div className="text-xs text-gray-500 text-center">L-Final</div>
                          {renderMatch('lf')}
                          {getBracketMatchTeam('lf') && (
                            <div className="mt-2 text-center">
                              <div className="text-xs text-yellow-400">{'\u2197'} to Grand Final</div>
                            </div>
                          )}
                          {getBracketMatchLoser('lf') && (
                            <div className="mt-2 bg-gradient-to-r from-amber-800 to-amber-700 p-2 rounded text-center border border-amber-500">
                              <div className="text-xs text-amber-200">{'\u{1F949}'} 3rd Place {'\u2014'} ${currentPayouts.third}</div>
                              {getBracketMatchLoser('lf').name.split(' / ').map((p, i) => (
                                <div key={i} className="text-xs font-semibold text-white">{p}</div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </>
                  )}
                </div>
              )}

              {/* ====== RESULTS TAB ====== */}
              {phase === 'results' && (
                <div className="max-w-2xl mx-auto">
                  <h2 className="text-2xl font-bold text-center mb-6">{'\u{1F3C6}'} Final Results</h2>

                  <div className="space-y-4">
                    {gfWinner && (
                      <div className="bg-gradient-to-r from-yellow-700 to-yellow-600 p-6 rounded-lg border-2 border-yellow-400 text-center">
                        <div className="text-lg text-yellow-200">{'\u{1F947}'} 1st Place {'\u2014'} ${currentPayouts.first}</div>
                        {gfWinner.name.split(' / ').map((p, i) => (
                          <div key={i} className="text-2xl font-bold text-white">{p}</div>
                        ))}
                      </div>
                    )}

                    {getBracketMatchLoser(finalMatchId) && (
                      <div className="bg-gradient-to-r from-gray-500 to-gray-400 p-5 rounded-lg border-2 border-gray-300 text-center">
                        <div className="text-md text-gray-200">{'\u{1F948}'} 2nd Place {'\u2014'} ${currentPayouts.second}</div>
                        {getBracketMatchLoser(finalMatchId).name.split(' / ').map((p, i) => (
                          <div key={i} className="text-xl font-bold text-white">{p}</div>
                        ))}
                      </div>
                    )}

                    {(bracketType === 'single' ? getBracketMatchTeam(thirdMatchId) : getBracketMatchLoser(thirdMatchId)) && (
                      <div className="bg-gradient-to-r from-amber-800 to-amber-700 p-4 rounded-lg border-2 border-amber-500 text-center">
                        <div className="text-sm text-amber-200">{'\u{1F949}'} 3rd Place {'\u2014'} ${currentPayouts.third}</div>
                        {(bracketType === 'single' ? getBracketMatchTeam(thirdMatchId) : getBracketMatchLoser(thirdMatchId)).name.split(' / ').map((p, i) => (
                          <div key={i} className="text-lg font-bold text-white">{p}</div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Footer link */}
              <div className="text-center mt-8">
                <a href="Jordan_Moneyball.html" className="text-gray-600 text-xs hover:text-gray-400 transition-colors">
                  Organizer Login
                </a>
              </div>
            </>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
